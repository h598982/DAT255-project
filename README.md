# DAT255-project

Innledning 
I faget DAT 255 deep learning engineering ble vi bedt om å velge et prosjekt som skulle være en god kilde til læring. Det ble presentert en katalog med mange valg, men på grunn av interessen for medisin valgte vi oppgaven «Chest X-rays» som handler om å identifisere sykdommer basert på røntgen bilder av brystet til pasienter.
Maskinlæring innen medisinfeltet er svært spennende og har et gigantisk potensial for fremtiden. Kunstig intelligens kan være med på å forbedre alt fra nøyaktigheten i diagnostikk til personalisering av behandlingsplaner. Teknologi som dyp læring har allerede vist seg verdifullt innen bildediagnostikk hvor de kan se mønstre og anomalier som selv eksperter fort kan overse. Prosjektet som har blitt utført er en smakebit for to studenter innenfor denne spennende teknologien som kan og mest sannsynlig vil bli et viktig verktøy innenfor moderne medisin.
Målet med dette prosjektet er å klare å identifisere en eller fler av totalt 14 forskjellige tilstander hos et menneske gjennom å analysere et røntgenbilde av brystpartiet. I tillegg til at vi skal kunne identifisere tilstander vil også fremstillingen av resultat og analyse være sentralt. 

Metode
Det ble utført mye utforskning av forskjellige datasett som lå tilgjengelig på nettet. Vi endte på valget om å bruke CheXpert sitt datasett siden dette var et kjent datasett som har vært brukt i konkurranser (kilde: https://stanfordmlgroup.github.io/competitions/chexpert/).  Dette gjør at vi som gruppe enklere kan måle oss mot andre siden det er mange som har levert inn sine resultater. Problemet som oppstod var bare at CheXpert sitt datasett var ekstremt stort og ikke ment for å kjøre på personlige bærbare datamaskiner. Vi fant derfor en variant av CheXpert sitt datasett på kaggle som ble kalt for «CheXpert-v1.0-small» hentet fra https://www.kaggle.com/datasets/mimsadiislam/chexpert.

I løsningen til prosjektet har vi benyttet oss av elementer som har blitt gjennomgått i forelesninger både digitalt og fysisk. Vi bestemte oss for å bruke fast.ai hovedsakelig siden dette har vært fokus gjennom semesteret. Det første vi gjorde var å fastsette hva slags prinsipper dette prosjektet hadde som ble avgjørende for metoden vi brukte under gjennomføring. Problemet vi skulle løse inneholdt prinsippene om bildegjenkjenning og classification. Siden vi skulle finne en eller flere tilstander i samme bilde var dette en multilabel classification som vil si at bilde kunne inneholde flere labels. 

Det første vi startet med var å behandle dataen og gjøre den klar for bruk i en maskinlærings modell. Dataen var allerede strukturert i en mappe struktur som tilsa hva som skulle være treningsdataen og hva som skulle være valideringsdataen. Vi valgte å beholde deres fordeling, hvert fall som en start. Datasettet innehold informasjonen, stien til bildet knyttet til pasienten, kjønn, alder, side bilde er tatt fra, type bilde og alle de 14 tilstandene. Tilstandene kunne ha verdien 1, 0 og -1 som stod for at tilstanden var til stede, ikke til stedet og usikkert om var til stedet. Dette valgte vi å håndtere på den enkleste måten ved å gjøre om usikkre variabler til at de var sikre. Dette er ikke beste måten å løse dette på, men for enkelhetens skyld valgte vi å gjøre dette. Vi oppdaget også at treningssettet inneholdt mye NaN verdier under tilstandene, noe som ikke blir godtatt inn i en maskinlæringsmodell så derfor omgjorde vi NaN verdier til verdien 0 som betydde at tilstanden ikke var til stedet på bildet.

Nå som dataen var klar for å bli brukt i en maskinlæringsmodell benyttet vi oss av elementer fra fast.ai. Det første vi ønsket å benytte oss av var DataBlock som er en fleksibel og modulær måte å definere hvordan dataen skal behandles. Før vi kunne benytte oss av DataBlock definerte vi to metoder som sa hvordan DataBlock-en skulle få tak i de forskjellige dataene. Metoden get_x sa hvordan den skulle få tak i bildet som skulle analyseres og get_y ga den svaret på hvilke tilstander som var til stedet. Etter at DataBlock-en var lagd brukte vi et annet fast.ai element som kalles DataLoader for å iterere over datasettet på måten DataBlock-en hadde definert. Nå som dataen var riktig behandlet og samlet i batches kunne vi lære opp en modell. Vi valgte å bruke en pre-trained modell, resnet18. Valget av resnet18 var relativt tilfeldig, vi hadde best kunnskap med arbeid på denne modellen og visste at den ville gi et relativt godt resultat. Etter at vi hadde lagd en learner fant vi forksjellige valg av learning rate som skulle si noe om hvor store steg som ble tatt under hyperparameterjusteringene. Vi trente kun modellen med en syklus siden det var svært tidkrevende å gjennomgå en rund side datasettet fortsatt var ganske stort for de bærbare maskinene vi hadde tilgjengelig. 

Etter at vi fikk resultatene valgte vi å prøve å presentere dataen slik at vi kunne forstå hvorfor vi fikk resultatene som var. Vi endte opp med en accuracy på sirka 84%, men det var flere av tilfellene som hadde svært store loss. Vi benyttet oss av en forvirrings matrise for å se hvilke tilstander modellen slet med og oppdaget da at valideringssettet ikke representerte alle tilstandene like godt. Dette vil bli snakket mer om i resultat delen av rapporten. Videre lagde vi et heat-map som viser hvor maskinlærings modellen vår så for å avgjøre den tilstanden hos pasienten som den var mest sikker på. 

Resultater

Resultatet vi endte opp med ved prosjekt slutt var rundt 84%, men valgte å ikke bruke en spesifikk seed. Dette tilsier at vi er rundt plass nummer 200 i den originale konkurransen bassert på CheXpert sitt datasett. Det skal sier at vi ikke brukte det originale datasettet, men en mindre versjon av det. Så resultatet kan variere basert på dette.

Diskusjon

Arbeidet med dette prosjektet har vært lærerikt og interessant, men blitt delvis nedprioritert på grunn av bachelor oppgaven som har blitt arbeidet med samtidig. Det er flere ting som vi gjerne skulle arbeidet mer med for å forbedre modellen, men alt i alt har vi klart å lage en nokså god modell som kan identifisere opp til 14 tilstander ut ifra en røntgen av brystpartiet. Vi har også klart å presentere dette på en måte som gir folk forståelse av hva modellen ser på for å avgjøre tilstandene.
Det vi gjerne skulle ønsket vi kunne fått tid til å arbeide videre med handler hovedsakelig om forberedelsen av dataen før man trener modellen. Hovedsakelig er det to ting vi hadde ønsket å prøve ut for å forbedre modellen. Det første er håndteringen av usikker tilstand (-1 verdi), måten vi gjorde dette på er uten tvil ikke den beste måten. Vi tenkte på hva vi kunne gjøre, men kom ikke frem til et endelig svar siden vi følte det krevde forståelse av røntgen bilder noe vi ikke har. Det andre vi gjerne skulle fått gjort hadde vært å slå sammen både trenings og valideringssettet og lagd et eget valideringssett som hadde flere representasjoner i seg. Etter vi lagde forvirringsmatrisen så vi at valideringssettet kun hadde negative eller positive tilfeller av en tilstand i seg. Dette kan føre til at resultatet vårt på 84% kanskje ikke er så reelt hvis den hadde blitt brukt på ny data. Dette grunnes av at modellen er fant ut at den alltid kunne si at en tilstand ikke var til stede og få riktig nesten hver gang. Vi ønsker derfor å bygge valideringssettet på en måte som sørger for at alle tilstandene er representert relativt likt. Dette vil føre til at modellen vil se mye flere forskjellige cases og gjøre den mer robust mot det virkelige liv. Dette kan også føre til at modellen sin accuracy går ned, men kan også føre til at den forbedres.

Prosjekt link (offentlig prosjekt)

https://www.kaggle.com/code/solhjell/chexpert-hvl
